# 크롤링 문제 및 해결 방안

## 현재 상태

### ✅ 작동하는 쇼핑몰
- **알라딘**: 정상 작동 (예: Radiohead - In Rainbows에서 21,100원 찾음)

### ⚠️ 부분 작동 또는 문제 있는 쇼핑몰

#### 1. 봇 차단 (HTTP 403, 418)
- **네이버 스마트스토어**: HTTP 418 (I'm a teapot) - 봇 차단
- **쿠팡**: HTTP 403 (Forbidden) - 봇 차단

**해결 방안:**
- 더 현실적인 User-Agent 사용 (완료)
- 헤더 추가 (Accept-Encoding, Connection 등) (완료)
- puppeteer 사용 고려 (JavaScript 렌더링 필요)

#### 2. HTML 구조 문제
- **YES24**: 검색 결과가 다른 구조로 표시됨
  - 현재: `.goodsList_item`, `.itemUnit` 선택자 사용
  - 실제: 다른 클래스명 사용 가능

**해결 방안:**
- 실제 YES24 검색 페이지 HTML 구조 확인 필요
- 선택자 업데이트

#### 3. 타임아웃 문제
- **인터파크**: AbortError (타임아웃)
- **향뮤직**: AbortError (타임아웃)

**해결 방안:**
- 타임아웃 시간 증가 (10초 → 15초) (완료)
- 재시도 로직 개선

#### 4. 404 에러
- **교보문고**: HTTP 404 - 검색 URL이 잘못되었을 수 있음

**해결 방안:**
- 실제 교보문고 검색 URL 확인 및 수정

#### 5. 접근 불가
- **김밥레코드**: 사이트 구조가 다르거나 접근 불가
- **마장뮤직앤픽쳐스**: 사이트 구조가 다르거나 접근 불가

**해결 방안:**
- 실제 사이트 URL 및 검색 구조 확인 필요

## 개선 사항

### 완료된 개선
1. ✅ User-Agent 업데이트 (Chrome 131)
2. ✅ 헤더 추가 (Accept-Encoding, Connection, Sec-Fetch-* 등)
3. ✅ 타임아웃 시간 증가 (10초 → 15초)
4. ✅ 에러 처리 개선 (403, 418 에러 감지)
5. ✅ 상세 로그 추가

### 추가 개선 필요
1. **puppeteer 도입** (쿠팡, 네이버 등 JavaScript 렌더링 필요)
2. **선택자 업데이트** (YES24 등 HTML 구조 변경 대응)
3. **검색 URL 수정** (교보문고 등)
4. **프록시 사용** (봇 차단 우회)

## 우선순위

### 높음 (즉시 해결)
1. 알라딘 - 정상 작동 중 ✅
2. YES24 - HTML 구조 확인 및 선택자 업데이트
3. 교보문고 - 검색 URL 수정

### 중간 (점진적 개선)
1. 네이버 스마트스토어 - puppeteer 도입 검토
2. 쿠팡 - puppeteer 도입 검토
3. 인터파크, 향뮤직 - 타임아웃 문제 해결

### 낮음 (나중에)
1. 김밥레코드, 마장뮤직앤픽쳐스 - 사이트 구조 확인

## 테스트 방법

```bash
# 특정 제품으로 테스트
npm run test-price-crawling

# 전체 동기화 테스트
npm run sync-lp-prices
```

## 참고

- 알라딘은 현재 정상 작동하므로 우선 사용 가능
- 다른 쇼핑몰은 점진적으로 개선
- 봇 차단이 심한 쇼핑몰은 puppeteer나 API 사용 검토 필요

