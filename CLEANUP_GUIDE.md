# 데이터 정리 가이드

## 문제 상황
기존에 수집된 데이터에 부정확한 정보가 많이 포함되어 있습니다:
- CD, 포스터, 굿즈 등 LP가 아닌 상품
- 체중계, 책 등 완전히 다른 카테고리의 상품
- 아티스트/앨범명이 불일치하는 매칭 오류
- 중복된 offers
- 비정상적인 가격 (너무 저렴하거나 비싼 경우)

## 해결 방법

### 1. 강력한 데이터 정리 스크립트 실행

```bash
npm run aggressive-cleanup
```

이 스크립트는 다음을 수행합니다:
1. **부정확한 offers 제거**: URL 검증, 가격 검증
2. **부정확한 products 제거**: CD/포스터/굿즈 키워드, 포맷 검증, 아티스트명 매칭 검증
3. **중복 offers 제거**: 같은 제품의 같은 URL은 하나만 유지
4. **비정상 가격 제거**: 20,000원 미만 또는 1,000,000원 초과
5. **offers가 없는 products 확인** (삭제는 선택사항)

### 2. 검증 기준

#### URL 검증
- 명시적으로 잘못된 카테고리 차단: `/book/`, `/clothing/`, `/health/`, `/scale/` 등
- 네이버 스마트스토어는 URL만으로는 판단 어려우므로 통과 (제품명 검증에 의존)

#### LP 매칭 검증
- **LP 키워드 필수**: `lp`, `vinyl`, `바이닐`, `엘피`, `레코드`, `record`, `12"`, `12인치` 중 하나 이상 포함
- **CD/디지털 차단**: `cd`, `compact disc`, `디지털`, `digital`, `mp3` 등
- **포스터/굿즈 차단**: `poster`, `포스터`, `굿즈`, `goods`, `merch` 등
- **아티스트명 정확 매칭 필수**: 제품명에 아티스트명이 포함되어야 함
- **앨범명 95% 이상 매칭 필수**: 앨범명의 단어 중 95% 이상이 제품명에 포함되어야 함

#### 가격 검증
- **최소 가격**: 20,000원 (CD나 액세서리 차단)
- **최대 가격**: 1,000,000원 (비정상적으로 비싼 상품 차단)

### 3. 기존 정리 스크립트

기존 `cleanup.ts`의 함수들도 사용할 수 있습니다:

```bash
# 개별 정리 함수 실행
tsx scripts/cleanup.ts
```

또는 Node.js에서 직접 import:

```typescript
import { cleanupAllInaccurateData } from './scripts/cleanup';

await cleanupAllInaccurateData();
```

## 주의사항

⚠️ **데이터 정리 스크립트는 되돌릴 수 없습니다!**
- 실행 전에 데이터베이스 백업을 권장합니다
- 테스트 환경에서 먼저 실행해보세요
- 중요한 데이터가 삭제될 수 있습니다

## 실행 후 확인

정리 후 다음을 확인하세요:
1. 제품 수가 적절히 감소했는지
2. offers 수가 적절히 감소했는지
3. 남은 데이터가 정확한지 (샘플 확인)

## 자동 정리

`hourly-sync` 스크립트에 기본 정리 함수가 포함되어 있어, 주기적으로 실행되면 자동으로 정리됩니다.
